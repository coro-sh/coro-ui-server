import{C}from"../chunks/nMQjHOAs.js";import{n as s}from"../chunks/Cmrg4eaL.js";import{a as t}from"../chunks/DhsVcIO_.js";import{t as E,U}from"../chunks/DpPW9MOW.js";import{I as _}from"../chunks/BOokwqsW.js";import{c as y}from"../chunks/DfBZ-Z-X.js";import"../chunks/DsnmJJEf.js";import{p as x,m as N,b as S,f as v,a as j,d as O,g as P}from"../chunks/BbLl-hmz.js";import{c as h,a as p,f as k}from"../chunks/BGV7lBZC.js";import{s as z}from"../chunks/CxOjX-KX.js";import{i as w}from"../chunks/CR32N0-5.js";import{p as A}from"../chunks/CD-YXIRN.js";import{E as M}from"../chunks/CqQZYr2X.js";async function I(){s.setLoading(!0);try{const i=await new C().paginateNamespaces(100).fetchNext();return s.setNamespaces(i),{namespaces:i,error:void 0}}catch(a){return{namespaces:[],error:E(a)}}finally{s.setLoading(!1)}}const R=async({params:a})=>{if(_){t.setLoading(!0);let r=null;try{r=await y.fetchMe(),t.setUser(r),t.setError(null)}catch(c){const e=E(c);if(e instanceof U)return t.setError("Please log in to continue"),t.clear(),y.login(),{namespaces:[],error:e,user:null};console.error("Failed to fetch user:",e),t.setError(e.message),t.setUser(null)}finally{t.setLoading(!1)}const{namespaces:o,error:u}=await I();if(a.namespace&&o.find(c=>c.id===a.namespace))s.setActiveId(a.namespace);else if(o.length){const c=o.find(e=>e.name==="default");s.setActiveId(c?.id??o[0].id)}return{namespaces:o,error:u,user:r}}const{namespaces:n,error:i}=await I();if(a.namespace&&n.find(r=>r.id===a.namespace))s.setActiveId(a.namespace);else if(n.length){const r=n.find(o=>o.name==="default");s.setActiveId(r?.id??n[0].id)}return{namespaces:n,error:i}},Z=Object.freeze(Object.defineProperty({__proto__:null,load:R},Symbol.toStringTag,{value:"Module"}));var D=k('<div class="flex h-screen items-center justify-center"><div class="text-muted-foreground">Redirecting to login...</div></div>');function $(a,n){x(n,!0);let i=O(!1);N(()=>{const e=A.params.namespace,l=s.namespaces;if(l.length)if(e)l.find(m=>m.id===e)?(S(i,!1),s.setActiveId(e)):S(i,!0);else{const m=l.find(g=>g.name==="default");s.setActiveId(m?.id??l[0].id)}else A.url.pathname!=="/"&&(window.location.href="/")}),N(()=>{_&&!t.isAuthenticated&&!t.loading&&y.login()});var r=h(),o=v(r);{var u=e=>{M(e)},c=e=>{var l=h(),m=v(l);{var g=f=>{var d=D();p(f,d)},L=f=>{var d=h(),b=v(d);z(b,()=>n.children),p(f,d)};w(m,f=>{_&&!t.isAuthenticated?f(g):f(L,!1)},!0)}p(e,l)};w(o,e=>{P(i)?e(u):e(c,!1)})}p(a,r),j()}export{$ as component,Z as universal};
