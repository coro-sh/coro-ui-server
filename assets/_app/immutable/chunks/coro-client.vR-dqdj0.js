var T=Object.defineProperty;var g=(s,e,t)=>e in s?T(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var i=(s,e,t)=>g(s,typeof e!="symbol"?e+"":e,t);import{a}from"./namespace.DYAXPB0R.js";import{N as o}from"./scheduler.CbFSYGZU.js";function d(s,e){const t=new Error(e);return t.name=s,t}function E(s,e){const t=new Error(e.join(";"));return t.name=s,t}function l(s,e){const t=new Error(`${s} ${e}`);return t.name="Error Response",t}function f(){return d("Bad Response","Unsupported response schema")}function y(s){return d("Bad Response",`Unsupported Content-Type: ${s}`)}function C(s){return d("Bad Response",`Expected no content 204 status but received: ${s}`)}function N(s){const e=q(s);return e.name="Network Error",e}function U(s){const e=new Error(s);return e.name="Unexpected",e}function x(){const s=new Error("An unknown error occurred");return s.name="Unknown",s}function q(s){return s instanceof Error?s:typeof s=="string"?U(s):x()}class b{constructor(e){i(this,"baseURL");this.baseURL=e}async request(e,t={}){const n=await this.fetch(e,t),r=n.headers.get("Content-Type")||"";if(r.includes("application/json")){const c=await n.json().catch(()=>null);if(n.ok||this.handleErrorBody(n.status,n.statusText,c),c&&"data"in c)return c.data;throw f()}if(r.includes("text/plain")){const c=await n.text().catch(()=>"");if(!n.ok)throw l(n.status,n.statusText);return c}throw y(r)}async requestNoContent(e,t={}){const n=await this.fetch(e,t);if(!n.ok)throw l(n.status,n.statusText);if(n.status!==204)throw C(n.status)}async download(e,t,n={}){const r=await this.fetch(e,n),c=r.headers.get("Content-Type")||"";if(!c.includes("text/plain"))throw y(c);const p=r.headers.get("Content-Disposition"),m=p==null?void 0:p.match(/filename="(.+)"/),w=m?m[1]:t,$=await r.blob(),u=document.createElement("a");u.href=URL.createObjectURL($),u.download=w,document.body.appendChild(u),u.click(),document.body.removeChild(u)}async requestPage(e,t={}){const n=await this.fetch(e,t),r=n.headers.get("Content-Type")||"";if(!r.includes("application/json"))throw y(r);const c=await n.json().catch(()=>null);if(n.ok||this.handleErrorBody(n.status,n.statusText,c),c&&"data"in c)return c;throw f()}async fetch(e,t){const n=`${this.baseURL}${e}`;try{return await fetch(n,t)}catch(r){throw N(r)}}handleErrorBody(e,t,n){if(n&&"error"in n&&n.error){const{message:r,details:c}=n.error,p=r;throw c&&c.length>0?E(p,c):d(p)}else throw l(e,t)}}class h{constructor(e,t,n,r){i(this,"client");i(this,"path");i(this,"size");i(this,"cursor");i(this,"hasNextPage",!0);this.client=e,this.path=t,this.size=n,this.cursor=r}async fetchNext(){if(!this.hasNext())return[];const e=new URLSearchParams;(this.size!==void 0||this.cursor!==void 0)&&(this.size!==void 0&&e.append("page_size",this.size.toString()),this.cursor!==void 0&&e.append("page_cursor",this.cursor.toString()));const t=e.toString(),n=t?`${this.path}?${t}`:this.path,r=await this.client.requestPage(n);return r.next_page_cursor?this.cursor=r.next_page_cursor:(this.cursor=void 0,this.hasNextPage=!1),r.data}hasNext(){return this.hasNextPage}reset(){this.cursor=void 0,this.hasNextPage=!0}}function O(){const s="";return s.endsWith("/")?s.slice(0,-1):s}class R{constructor(){i(this,"client");const e=O();this.client=new b(e+"/api/v1")}async createNamespace(e){return this.client.request("/namespaces",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})}paginateNamespaces(e,t){return new h(this.client,"/namespaces",e,t)}async deleteNamespace(e){return this.client.requestNoContent(`/namespaces/${e}`,{method:"DELETE"})}async createOperator(e){return this.client.request(`/namespaces/${o(a)}/operators`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})}async updateOperatorName(e,t){return this.client.request(`/namespaces/${o(a)}/operators/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})})}async fetchOperator(e){return this.client.request(`/namespaces/${o(a)}/operators/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}})}async fetchNATSConfigContent(e){return this.client.request(`/namespaces/${o(a)}/operators/${e}/nats-config`,{method:"GET",headers:{"Content-Type":"text/plain"}})}paginateOperators(e,t){return new h(this.client,`/namespaces/${o(a)}/operators`,e,t)}async deleteOperator(e){return this.client.requestNoContent(`/namespaces/${o(a)}/operators/${e}`,{method:"DELETE"})}async createAccount(e,t){return this.client.request(`/namespaces/${o(a)}/operators/${e}/accounts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async updateAccount(e,t){return this.client.request(`/namespaces/${o(a)}/accounts/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async fetchAccount(e){return this.client.request(`/namespaces/${o(a)}/accounts/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}})}paginateAccounts(e,t,n){return new h(this.client,`/namespaces/${o(a)}/operators/${e}/accounts`,t,n)}async deleteAccount(e){return this.client.requestNoContent(`/namespaces/${o(a)}/accounts/${e}`,{method:"DELETE"})}async createUser(e,t){return this.client.request(`/namespaces/${o(a)}/accounts/${e}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async updateUser(e,t){return this.client.request(`/namespaces/${o(a)}/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async fetchUser(e){return this.client.request(`/namespaces/${o(a)}/users/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}})}async downloadUserCreds(e){await this.client.download(`/namespaces/${o(a)}/users/${e}/creds`,`${e}.creds`)}paginateUsers(e,t,n){return new h(this.client,`/namespaces/${o(a)}/accounts/${e}/users`,t,n)}async deleteUser(e){return this.client.requestNoContent(`/namespaces/${o(a)}/users/${e}`,{method:"DELETE"})}paginateUserIssuances(e,t,n){return new h(this.client,`/namespaces/${o(a)}/users/${e}/issuances`,t,n)}async createOperatorProxyToken(e){return this.client.request(`/namespaces/${o(a)}/operators/${e}/proxy/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:null})}async getOperatorProxyStatus(e){return this.client.request(`/namespaces/${o(a)}/operators/${e}/proxy/status`,{method:"GET",headers:{"Content-Type":"application/json"},body:null})}}export{R as C,d as n,q as t};
