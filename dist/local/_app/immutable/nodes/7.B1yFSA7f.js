import"../chunks/DsnmJJEf.js";import{o as $t}from"../chunks/DGHSwugD.js";import{p as pe,f as s,g as e,u as P,s as a,n as L,t as qe,a as ge,d as p,i as be,c as $,b as t,r as b,h as lt,aQ as wt,$ as Pt}from"../chunks/BbLl-hmz.js";import{s as Ue}from"../chunks/DTULLxbT.js";import{p as G,i as M,s as Tt,r as Ct}from"../chunks/CR32N0-5.js";import{e as it,s as de,I as St,i as At,L as tt,a as Mt}from"../chunks/DdZiSI1B.js";import{c as S,f as w,t as ke,a as r}from"../chunks/BGV7lBZC.js";import{c as F}from"../chunks/DU2gS9WV.js";import{h as Nt}from"../chunks/DhNQZhGX.js";import{B as rt}from"../chunks/BXD1d4a_.js";import{B as Ge,n as Ot}from"../chunks/DpPW9MOW.js";import{B as kt,a as at,b as Et,H as It,S as He,c as Dt,C as ot}from"../chunks/SAkFzdjK.js";import{d as Ye,B as Bt,f as zt,C as xe}from"../chunks/ChvAwCEJ.js";import{E as Rt,a as jt,A as Kt}from"../chunks/DUMTNqXv.js";import{C as st,S as Lt,E as Ft,T as Gt,a as Xe}from"../chunks/BW4Kav-m.js";import{n as Ht}from"../chunks/Cmrg4eaL.js";import{E as dt,L as ct,I as ut}from"../chunks/D6TB6_0Q.js";import{C as Ee}from"../chunks/nMQjHOAs.js";import{g as Yt}from"../chunks/CoSZus2y.js";import{s as Xt,h as qt}from"../chunks/CxOjX-KX.js";import{E as Ut}from"../chunks/CqQZYr2X.js";import{p as nt}from"../chunks/WKKXBKGT.js";import{I as Qt}from"../chunks/D9kVZ9e-.js";import{D as Jt}from"../chunks/PFmyF5LW.js";import{R as Vt}from"../chunks/CCA7G2DJ.js";var Wt=w("<!> <!> <!>",1);function Zt(k,n){pe(n,!0);let d=G(n,"loading",15,!0),v=G(n,"openCreateModal",15,!1),o=G(n,"hasMore",15,!1),m=G(n,"loadingMore",15,!1);const g=["ID","Name","Public Key",""];{let T=P(()=>n.accounts.length===0);Rt(k,{entityType:"account",get columns(){return g},get isEmpty(){return e(T)},get onloadmore(){return n.onloadmore},get loading(){return d()},set loading(i){d(i)},get openCreateModal(){return v()},set openCreateModal(i){v(i)},get hasMore(){return o()},set hasMore(i){o(i)},get loadingMore(){return m()},set loadingMore(i){m(i)},children:(i,y)=>{var _=S(),u=s(_);it(u,19,()=>n.accounts,h=>h.id,(h,l,f)=>{{let C=P(()=>`/namespaces/${Ht.activeId}/operators/${e(l).operator_id}/${e(l).id}`),H=P(()=>e(f)<n.accounts.length-1);jt(h,{get href(){return e(C)},get bottomBorder(){return e(H)},children:(A,ye)=>{var re=Wt(),$e=s(re);F($e,()=>Ye,(Y,ae)=>{ae(Y,{children:(oe,Te)=>{{let J=P(()=>`account-id-${e(l).id}`),c=P(()=>e(l).id??"");st(oe,{get spanId(){return e(J)},get text(){return e(c)}})}},$$slots:{default:!0}})});var we=a($e,2);F(we,()=>Ye,(Y,ae)=>{ae(Y,{children:(oe,Te)=>{L();var J=ke();qe(()=>Ue(J,e(l).name)),r(oe,J)},$$slots:{default:!0}})});var Pe=a(we,2);F(Pe,()=>Ye,(Y,ae)=>{ae(Y,{children:(oe,Te)=>{{let J=P(()=>`account-pk-${e(l).id}`),c=P(()=>e(l).public_key??"");st(oe,{get spanId(){return e(J)},get text(){return e(c)}})}},$$slots:{default:!0}})}),r(A,re)},$$slots:{default:!0}})}}),r(i,_)},$$slots:{default:!0}})}ge()}var er=w('<h3 class="col-span-2 text-lg font-medium">General</h3> <div class="col-span-2"><!> <!></div> <!> <!>',1);function tr(k,n){pe(n,!0);let d=G(n,"open",15,!1),v=G(n,"accounts",31,()=>be([])),o=p(!1),m=p(""),g=p(be({}));const T=new Ee;async function i(y){y.preventDefault();try{t(o,!0);const _=await T.createAccount(n.operatorId,{name:e(m),limits:e(g)});v([_,...v()]),t(m,""),t(g,{},!0),d(!1)}catch(_){de(_)}finally{t(o,!1)}}dt(k,{entityType:"account",modalType:"create",onsubmit:i,get open(){return d()},set open(y){d(y)},get loading(){return e(o)},set loading(y){t(o,y,!0)},children:(y,_)=>{var u=er(),h=a(s(u),2),l=$(h);ct(l,{for:"name",class:"mb-2",children:(A,ye)=>{L();var re=ke("Name");r(A,re)},$$slots:{default:!0}});var f=a(l,2);ut(f,{name:"name",placeholder:"Type account name",required:!0,get value(){return e(m)},set value(A){t(m,A,!0)}}),b(h);var C=a(h,2);Lt(C,{class:"col-span-2 my-2"});var H=a(C,2);Kt(H,{get limits(){return e(g)},set limits(A){t(g,A,!0)}}),r(y,u)},$$slots:{default:!0}}),ge()}var rr=w('<h3 class="col-span-2 text-lg font-medium">General</h3> <div class="col-span-2"><!> <!></div>',1);function ar(k,n){pe(n,!0);let d=G(n,"open",15,!1),v=G(n,"operator",15),o=p(!1),m=p(be(v().name));const g=new Ee;async function T(i){i.preventDefault();try{t(o,!0),v(await g.updateOperatorName(v().id,e(m))),d(!1)}catch(y){de(y)}finally{t(o,!1)}}dt(k,{entityType:"operator",modalType:"edit",get entityName(){return v().name},onsubmit:T,get open(){return d()},set open(i){d(i)},get loading(){return e(o)},set loading(i){t(o,i,!0)},children:(i,y)=>{var _=rr(),u=a(s(_),2),h=$(u);ct(h,{for:"name",class:"mb-2",children:(f,C)=>{L();var H=ke("Name");r(f,H)},$$slots:{default:!0}});var l=a(h,2);ut(l,{name:"name",placeholder:"Type operator name",required:!0,get value(){return e(m)},set value(f){t(m,f,!0)}}),b(u),r(i,_)},$$slots:{default:!0}}),ge()}var or=w("<!> <!>",1);function sr(k,n){pe(n,!0);let d=G(n,"operator",15),v=G(n,"loading",15,!0),o=p(!1);const m=["ID","Public Key"],g=["NATS Status","ID","Public Key"],T=P(()=>{const l=new Map;if(d())l.set("NATS Status",d().status.connected?"Connected":"Disconnected"),l.set("ID",d().id),l.set("Public Key",d().public_key);else for(const f of g)l.set(f,"Unknown");return l});async function i(){await new Ee().deleteOperator(d().id),await Yt("/")}var y=or(),_=s(y);{let l=P(()=>d()?.name),f=P(()=>d()?.jwt);Ft(_,{editable:!0,get name(){return e(l)},get copyableFields(){return m},get data(){return e(T)},get jwt(){return e(f)},deleteCallback:i,get loading(){return v()},set loading(C){v(C)},get openEditModal(){return e(o)},set openEditModal(C){t(o,C,!0)}})}var u=a(_,2);{var h=l=>{ar(l,{get open(){return e(o)},set open(f){t(o,f,!0)},get operator(){return d()},set operator(f){d(f)}})};M(u,l=>{d()&&l(h)})}r(k,y),ge()}function nr(k,n){pe(n,!0);let d=Ct(n,["$$slots","$$events","$$legacy"]);const v=[["path",{d:"M12 13v8"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}],["path",{d:"m8 17 4-4 4 4"}]];St(k,Tt({name:"cloud-upload"},()=>d,{get iconNode(){return v},children:(o,m)=>{var g=S(),T=s(g);Xt(T,()=>n.children??lt),r(o,g)},$$slots:{default:!0}})),ge()}var lr=w("<!> Operators",1),ir=w("<!> <!> <!>",1),dr=w('<h1 class="text-3xl font-bold"> </h1>'),cr=w('<div class="space-y-4"></div>'),ur=w("<!> Connected",1),vr=w('<div class="mb-8 flex items-center justify-between"><div class="flex items-center gap-2"><h2 class="text-xl font-semibold sm:text-2xl">NATS Server</h2> <!></div></div> <p class="text-muted-foreground mb-5">Connected with the server config below.</p> <!>',1),fr=w("<!> Disconnected",1),mr=w("<!> Download Config",1),pr=w("<!> Generate Proxy Token",1),gr=w("<!> Test Connection",1),_r=w(`<div class="bg-muted/30 dark:bg-muted/50 -mx-2 -mt-2 mb-6 flex items-center justify-center gap-3 rounded-lg p-4"><!> <span class="text-foreground text-sm">NATS server not connected</span></div> <div class="mb-4 flex items-center justify-between"><h2 class="text-xl font-semibold sm:text-2xl">Connect a new NATS server</h2></div> <div class="space-y-8"><div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">1</div> <div class="bg-border mt-2 h-full w-px"></div></div> <div class="flex-1 pb-8"><h3 class="mb-2 font-semibold">Server config</h3> <p class="text-muted-foreground mb-4">Download the NATS server config for your Operator.</p> <!> <p class="text-muted-foreground mb-2">Preview:</p> <!></div></div> <div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">2</div> <div class="bg-border mt-2 h-full w-px"></div></div> <div class="flex-1 pb-8"><h3 class="mb-2 font-semibold">Start the server</h3> <p class="text-muted-foreground mb-4">Start your Operator NATS server using the saved config.</p> <!></div></div> <div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">3</div> <div class="bg-border mt-2 h-full w-px"></div></div> <div class="flex-1 pb-8"><h3 class="mb-2 font-semibold">Proxy Agent token</h3> <p class="text-muted-foreground mb-4">Generate a new Proxy Agent authorization token. Please note that it cannot be
											retrieved again later and must be regenerated if lost.</p> <!></div></div> <div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">4</div></div> <div class="flex-1"><h3 class="mb-2 font-semibold">Run the Proxy Agent</h3> <p class="text-muted-foreground mb-4">The Coro Proxy Agent is a lightweight service that connects your Operator NATS
											server to Coro. You can run the service as a Docker container using the latest
											Coro Proxy Agent image.</p> <!> <!></div></div></div>`,1),hr=w('<!> <div class="mb-6"><!></div> <!>',1),xr=w("<main><!></main> <!>",1);function Yr(k,n){pe(n,!0);const d=P(()=>nt.params.namespace??""),v=P(()=>nt.params.operator??"");let o=p(!0),m=p(!0),g=p(!1),T=p(!1),i=p(!1),y=p(!1),_=p(!1),u=p(void 0),h=p(be([])),l=p(!1),f=p(""),C=p(""),H=p(be(Qt?`docker run --rm corosh/coro-proxy-agent \\
	--token <PROXY_TOKEN> \\
	--nats-url nats://<NATS_HOST_PORT>`:`docker run --rm corosh/coro-proxy-agent \\
	--token <PROXY_TOKEN> \\
	--nats-url nats://<NATS_HOST_PORT> \\
	--broker-url ws://<BROKER_HOST_PORT>/api/v1/broker`));const A=new Ee,ye=P(()=>A.paginateAccounts(e(v)));$t(async()=>{t(o,!0);try{t(u,await A.fetchOperator(e(v)),!0),await re(),t(m,!0),t(f,await A.fetchNATSConfigContent(e(v)),!0)}catch(c){de(c),t(y,!0)}finally{t(o,!1),t(m,!1)}});async function re(){t(i,!0);try{const c=await e(ye).fetchNext();t(h,[...e(h),...c],!0),t(l,e(ye).hasNext(),!0)}catch(c){de(c)}finally{t(i,!1)}}async function $e(){try{t(g,!0);const c=await A.createOperatorProxyToken(e(v));t(C,c.token,!0),t(H,e(H).replace("<PROXY_TOKEN>",e(C)),!0)}catch(c){de(c)}finally{t(g,!1)}}async function we(){if(e(u))try{t(T,!0),e(u).status=await A.getOperatorProxyStatus(e(v)),e(u).status.connected?Mt("NATS server connected"):de(Ot("NATS server not connected"))}catch(c){de(c)}finally{t(T,!1)}}var Pe=xr();Nt("1igyulh",c=>{wt(()=>{Pt.title=e(u)?.name?`${e(u).name} - Coro`:"Operator - Coro"})});var Y=s(Pe),ae=$(Y);{var oe=c=>{Ut(c)},Te=c=>{var ce=hr(),Qe=s(ce);F(Qe,()=>Dt,(X,se)=>{se(X,{class:"mb-8",children:(ne,De)=>{var Ce=S(),Be=s(Ce);F(Be,()=>kt,(ze,V)=>{V(ze,{children:(ue,Re)=>{var le=ir(),ve=s(le);F(ve,()=>at,(N,z)=>{z(N,{children:(q,_e)=>{var W=S(),x=s(W);{let R=P(()=>`/namespaces/${e(d)}/operators`);F(x,()=>Et,(ie,fe)=>{fe(ie,{get href(){return e(R)},class:"flex items-center gap-2",children:(Se,j)=>{var K=lr(),I=s(K);It(I,{class:"size-4"}),L(),r(Se,K)},$$slots:{default:!0}})})}r(q,W)},$$slots:{default:!0}})});var E=a(ve,2);F(E,()=>Bt,(N,z)=>{z(N,{})});var B=a(E,2);F(B,()=>at,(N,z)=>{z(N,{children:(q,_e)=>{var W=S(),x=s(W);F(x,()=>zt,(R,ie)=>{ie(R,{children:(fe,Se)=>{var j=S(),K=s(j);{var I=D=>{He(D,{class:"h-4 w-24"})},me=D=>{var Z=ke();qe(()=>Ue(Z,e(u)?.name)),r(D,Z)};M(K,D=>{e(o)?D(I):D(me,!1)})}r(fe,j)},$$slots:{default:!0}})}),r(q,W)},$$slots:{default:!0}})}),r(ue,le)},$$slots:{default:!0}})}),r(ne,Ce)},$$slots:{default:!0}})});var Ie=a(Qe,2),vt=$(Ie);{var ft=X=>{He(X,{class:"h-9 w-48"})},mt=X=>{var se=dr(),ne=$(se,!0);b(se),qe(()=>Ue(ne,e(u)?.name)),r(X,se)};M(vt,X=>{e(o)?X(ft):X(mt,!1)})}b(Ie);var pt=a(Ie,2);Gt(pt,{tabNames:["Overview","NATS","Accounts"],children:(se,ne=lt)=>{var De=S(),Ce=s(De);{var Be=V=>{Xe(V,{children:(ue,Re)=>{var le=S(),ve=s(le);{var E=B=>{sr(B,{get loading(){return e(o)},set loading(N){t(o,N,!0)},get operator(){return e(u)},set operator(N){t(u,N,!0)}})};M(ve,B=>{e(u)&&B(E)})}r(ue,le)}})},ze=V=>{var ue=S(),Re=s(ue);{var le=E=>{Xe(E,{children:(B,N)=>{var z=S(),q=s(z);{var _e=x=>{var R=cr();it(R,20,()=>({length:5}),At,(ie,fe)=>{He(ie,{class:"h-4 w-full"})}),b(R),r(x,R)},W=x=>{var R=S(),ie=s(R);{var fe=j=>{var K=vr(),I=s(K),me=$(I),D=a($(me),2);rt(D,{variant:"success",class:"mt-0.5 flex items-center gap-1",children:(Ae,je)=>{var Me=ur(),he=s(Me);ot(he,{class:"size-1.5! fill-current"}),L(),r(Ae,Me)},$$slots:{default:!0}}),b(me),b(I);var Z=a(I,4);xe(Z,{get loading(){return e(m)},get content(){return e(f)},wrap:!0}),r(j,K)},Se=j=>{var K=_r(),I=s(K),me=$(I);rt(me,{variant:"destructive",class:"flex w-fit items-center gap-1",children:(O,Ne)=>{var U=fr(),ee=s(U);ot(ee,{class:"size-1.5! fill-current"}),L(),r(O,U)},$$slots:{default:!0}}),L(2),b(I);var D=a(I,4),Z=$(D),Ae=a($(Z),2),je=a($(Ae),4);Ge(je,{variant:"outline",onclick:()=>qt(e(f),"nats.conf"),class:"mb-4",children:(O,Ne)=>{var U=mr(),ee=s(U);Jt(ee,{class:"size-4"}),L(),r(O,U)},$$slots:{default:!0}});var Me=a(je,4);xe(Me,{get loading(){return e(m)},get content(){return e(f)},wrap:!0}),b(Ae),b(Z);var he=a(Z,2),Je=a($(he),2),gt=a($(Je),4);xe(gt,{loading:!1,content:"nats-server -c nats.conf"}),b(Je),b(he);var Ke=a(he,2),Ve=a($(Ke),2),_t=a($(Ve),4);{var ht=O=>{xe(O,{loading:!1,get content(){return e(C)}})},xt=O=>{Ge(O,{onclick:$e,class:"min-w-52",get disabled(){return e(g)},children:(Ne,U)=>{var ee=S(),Le=s(ee);{var Fe=Q=>{tt(Q,{class:"size-4 animate-spin"})},te=Q=>{var Oe=pr(),yt=s(Oe);Vt(yt,{class:"size-4"}),L(),r(Q,Oe)};M(Le,Q=>{e(g)?Q(Fe):Q(te,!1)})}r(Ne,ee)},$$slots:{default:!0}})};M(_t,O=>{e(C)?O(ht):O(xt,!1)})}b(Ve),b(Ke);var We=a(Ke,2),Ze=a($(We),2),et=a($(Ze),4);xe(et,{loading:!1,get content(){return e(H)}});var bt=a(et,2);Ge(bt,{class:"mt-5 min-w-44",onclick:we,get disabled(){return e(T)},children:(O,Ne)=>{var U=S(),ee=s(U);{var Le=te=>{tt(te,{class:"size-4 animate-spin"})},Fe=te=>{var Q=gr(),Oe=s(Q);nr(Oe,{class:"size-4"}),L(),r(te,Q)};M(ee,te=>{e(T)?te(Le):te(Fe,!1)})}r(O,U)},$$slots:{default:!0}}),b(Ze),b(We),b(D),r(j,K)};M(ie,j=>{e(u)?.status.connected?j(fe):j(Se,!1)},!0)}r(x,R)};M(q,x=>{e(o)?x(_e):x(W,!1)})}r(B,z)}})},ve=E=>{var B=S(),N=s(B);{var z=q=>{Xe(q,{children:(_e,W)=>{Zt(_e,{get accounts(){return e(h)},onloadmore:re,get loading(){return e(o)},set loading(x){t(o,x,!0)},get openCreateModal(){return e(_)},set openCreateModal(x){t(_,x,!0)},get hasMore(){return e(l)},set hasMore(x){t(l,x,!0)},get loadingMore(){return e(i)},set loadingMore(x){t(i,x,!0)}})}})};M(N,q=>{ne()===3&&q(z)},!0)}r(E,B)};M(Re,E=>{ne()===2?E(le):E(ve,!1)},!0)}r(V,ue)};M(Ce,V=>{ne()===1?V(Be):V(ze,!1)})}r(se,De)},$$slots:{default:!0}}),r(c,ce)};M(ae,c=>{e(y)?c(oe):c(Te,!1)})}b(Y);var J=a(Y,2);{let c=P(()=>e(u)?.id??"");tr(J,{get operatorId(){return e(c)},get accounts(){return e(h)},set accounts(ce){t(h,ce,!0)},get open(){return e(_)},set open(ce){t(_,ce,!0)}})}r(k,Pe),ge()}export{Yr as component};
