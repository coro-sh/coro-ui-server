import{C}from"../chunks/BdUt5oNp.js";import{n as r}from"../chunks/BBnCHKX8.js";import{a as t}from"../chunks/CfVMbLNN.js";import{t as E,U}from"../chunks/KJKHz_n6.js";import{I as _,c as y}from"../chunks/BS42R9kx.js";import"../chunks/DsnmJJEf.js";import{p as x,l as N,b as S,f as v,a as j,d as O,g as P}from"../chunks/BkBo4zcc.js";import{c as h,a as p,f as k}from"../chunks/UR9opbve.js";import{s as z}from"../chunks/CrH7mYYb.js";import{i as w}from"../chunks/BLQyWBbh.js";import{p as A}from"../chunks/9FnanwCX.js";import{E as M}from"../chunks/DjxZdDEO.js";const R=!1;async function I(){r.setLoading(!0);try{const i=await new C().paginateNamespaces(100).fetchNext();return r.setNamespaces(i),{namespaces:i,error:void 0}}catch(a){return{namespaces:[],error:E(a)}}finally{r.setLoading(!1)}}const D=async({params:a})=>{if(_){t.setLoading(!0);let s=null;try{s=await y.fetchMe(),t.setUser(s),t.setError(null)}catch(c){const e=E(c);if(e instanceof U)return t.setError("Please log in to continue"),t.clear(),y.login(),{namespaces:[],error:e,user:null};console.error("Failed to fetch user:",e),t.setError(e.message),t.setUser(null)}finally{t.setLoading(!1)}const{namespaces:o,error:u}=await I();if(a.namespace&&o.find(c=>c.id===a.namespace))r.setActiveId(a.namespace);else if(o.length){const c=o.find(e=>e.name==="default");r.setActiveId(c?.id??o[0].id)}return{namespaces:o,error:u,user:s}}const{namespaces:n,error:i}=await I();if(a.namespace&&n.find(s=>s.id===a.namespace))r.setActiveId(a.namespace);else if(n.length){const s=n.find(o=>o.name==="default");r.setActiveId(s?.id??n[0].id)}return{namespaces:n,error:i}},Z=Object.freeze(Object.defineProperty({__proto__:null,load:D,ssr:R},Symbol.toStringTag,{value:"Module"}));var F=k('<div class="flex h-screen items-center justify-center"><div class="text-muted-foreground">Redirecting to login...</div></div>');function $(a,n){x(n,!0);let i=O(!1);N(()=>{const e=A.params.namespace,l=r.namespaces;if(l.length)if(e)l.find(d=>d.id===e)?(S(i,!1),r.setActiveId(e)):S(i,!0);else{const d=l.find(g=>g.name==="default");r.setActiveId(d?.id??l[0].id)}else A.url.pathname!=="/"&&(window.location.href="/")}),N(()=>{_&&!t.isAuthenticated&&!t.loading&&y.login()});var s=h(),o=v(s);{var u=e=>{M(e)},c=e=>{var l=h(),d=v(l);{var g=f=>{var m=F();p(f,m)},L=f=>{var m=h(),b=v(m);z(b,()=>n.children),p(f,m)};w(d,f=>{_&&!t.isAuthenticated?f(g):f(L,!1)},!0)}p(e,l)};w(o,e=>{P(i)?e(u):e(c,!1)})}p(a,s),j()}export{$ as component,Z as universal};
