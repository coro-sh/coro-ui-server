import"../chunks/DsnmJJEf.js";import{o as Ct}from"../chunks/BMX_zOea.js";import{p as ce,f as s,g as e,u as C,s as n,n as L,t as Xe,a as ue,d as p,h as ke,c as $,b as t,r as x,e as Je}from"../chunks/BkBo4zcc.js";import{c as T,f as w,t as Oe,s as Ue,a as r}from"../chunks/UR9opbve.js";import{p as G,i as N,s as it,r as dt}from"../chunks/BLQyWBbh.js";import{e as ct,E as ut,L as vt,I as ft,s as de,a as mt,i as Mt,b as rt,c as At}from"../chunks/BmSp21oe.js";import{c as F}from"../chunks/UE325Gli.js";import{B as at}from"../chunks/CcFf8x0n.js";import{B as Ge,n as St}from"../chunks/KJKHz_n6.js";import{B as Nt,a as ot,b as kt,H as Ot,S as He,c as Et,C as st}from"../chunks/CNHvmY6Q.js";import{C as nt,d as Ye,S as Bt,E as Dt,B as It,f as zt,g as Rt,h as qe,i as be}from"../chunks/BTCx4YHe.js";import{E as jt,a as Kt,A as Lt}from"../chunks/B8gGh14P.js";import{n as Ft}from"../chunks/BBnCHKX8.js";import{C as Ee}from"../chunks/BdUt5oNp.js";import{g as Gt}from"../chunks/OzRvkOis.js";import{s as gt,h as Ht}from"../chunks/CrH7mYYb.js";import{E as Yt}from"../chunks/DjxZdDEO.js";import{p as lt}from"../chunks/C_unzFMM.js";import{D as qt}from"../chunks/4-9_djkn.js";var Xt=w("<!> <!> <!>",1);function Ut(A,a){ce(a,!0);let i=G(a,"loading",15,!0),u=G(a,"openCreateModal",15,!1),o=G(a,"hasMore",15,!1),m=G(a,"loadingMore",15,!1);const v=["ID","Name","Public Key",""];{let P=C(()=>a.accounts.length===0);jt(A,{entityType:"account",get columns(){return v},get isEmpty(){return e(P)},get onloadmore(){return a.onloadmore},get loading(){return i()},set loading(d){i(d)},get openCreateModal(){return u()},set openCreateModal(d){u(d)},get hasMore(){return o()},set hasMore(d){o(d)},get loadingMore(){return m()},set loadingMore(d){m(d)},children:(d,y)=>{var _=T(),f=s(_);ct(f,19,()=>a.accounts,h=>h.id,(h,l,g)=>{{let M=C(()=>`/namespaces/${Ft.activeId}/operators/${e(l).operator_id}/${e(l).id}`),H=C(()=>e(g)<a.accounts.length-1);Kt(h,{get href(){return e(M)},get bottomBorder(){return e(H)},children:(S,xe)=>{var re=Xt(),ye=s(re);F(ye,()=>Ye,(Y,ae)=>{ae(Y,{children:(oe,Pe)=>{{let Q=C(()=>`account-id-${e(l).id}`),c=C(()=>e(l).id??"");nt(oe,{get spanId(){return e(Q)},get text(){return e(c)}})}},$$slots:{default:!0}})});var $e=n(ye,2);F($e,()=>Ye,(Y,ae)=>{ae(Y,{children:(oe,Pe)=>{L();var Q=Oe();Xe(()=>Ue(Q,e(l).name)),r(oe,Q)},$$slots:{default:!0}})});var we=n($e,2);F(we,()=>Ye,(Y,ae)=>{ae(Y,{children:(oe,Pe)=>{{let Q=C(()=>`account-pk-${e(l).id}`),c=C(()=>e(l).public_key??"");nt(oe,{get spanId(){return e(Q)},get text(){return e(c)}})}},$$slots:{default:!0}})}),r(S,re)},$$slots:{default:!0}})}}),r(d,_)},$$slots:{default:!0}})}ue()}var Jt=w('<h3 class="col-span-2 text-lg font-medium">General</h3> <div class="col-span-2"><!> <!></div> <!> <!>',1);function Qt(A,a){ce(a,!0);let i=G(a,"open",15,!1),u=G(a,"accounts",31,()=>ke([])),o=p(!1),m=p(""),v=p(ke({}));const P=new Ee;async function d(y){y.preventDefault();try{t(o,!0);const _=await P.createAccount(a.operatorId,{name:e(m),limits:e(v)});u([_,...u()]),t(m,""),t(v,{},!0),i(!1)}catch(_){de(_)}finally{t(o,!1)}}ut(A,{entityType:"account",modalType:"create",onsubmit:d,get open(){return i()},set open(y){i(y)},get loading(){return e(o)},set loading(y){t(o,y,!0)},children:(y,_)=>{var f=Jt(),h=n(s(f),2),l=$(h);vt(l,{for:"name",class:"mb-2",children:(S,xe)=>{L();var re=Oe("Name");r(S,re)},$$slots:{default:!0}});var g=n(l,2);ft(g,{name:"name",placeholder:"Type account name",required:!0,get value(){return e(m)},set value(S){t(m,S,!0)}}),x(h);var M=n(h,2);Bt(M,{class:"col-span-2 my-2"});var H=n(M,2);Lt(H,{get limits(){return e(v)},set limits(S){t(v,S,!0)}}),r(y,f)},$$slots:{default:!0}}),ue()}var Vt=w('<h3 class="col-span-2 text-lg font-medium">General</h3> <div class="col-span-2"><!> <!></div>',1);function Wt(A,a){ce(a,!0);let i=G(a,"open",15,!1),u=G(a,"operator",15),o=p(!1),m=p(ke(u().name));const v=new Ee;async function P(d){d.preventDefault();try{t(o,!0),u(await v.updateOperatorName(u().id,e(m))),i(!1)}catch(y){de(y)}finally{t(o,!1)}}ut(A,{entityType:"operator",modalType:"edit",get entityName(){return u().name},onsubmit:P,get open(){return i()},set open(d){i(d)},get loading(){return e(o)},set loading(d){t(o,d,!0)},children:(d,y)=>{var _=Vt(),f=n(s(_),2),h=$(f);vt(h,{for:"name",class:"mb-2",children:(g,M)=>{L();var H=Oe("Name");r(g,H)},$$slots:{default:!0}});var l=n(h,2);ft(l,{name:"name",placeholder:"Type operator name",required:!0,get value(){return e(m)},set value(g){t(m,g,!0)}}),x(f),r(d,_)},$$slots:{default:!0}}),ue()}var Zt=w("<!> <!>",1);function er(A,a){ce(a,!0);let i=G(a,"operator",15),u=G(a,"loading",15,!0),o=p(!1);const m=["ID","Public Key"],v=["NATS Status","ID","Public Key"],P=C(()=>{const l=new Map;if(i())l.set("NATS Status",i().status.connected?"Connected":"Disconnected"),l.set("ID",i().id),l.set("Public Key",i().public_key);else for(const g of v)l.set(g,"Unknown");return l});async function d(){await new Ee().deleteOperator(i().id),await Gt("/")}var y=Zt(),_=s(y);{let l=C(()=>i()?.name),g=C(()=>i()?.jwt);Dt(_,{editable:!0,get name(){return e(l)},get copyableFields(){return m},get data(){return e(P)},get jwt(){return e(g)},deleteCallback:d,get loading(){return u()},set loading(M){u(M)},get openEditModal(){return e(o)},set openEditModal(M){t(o,M,!0)}})}var f=n(_,2);{var h=l=>{Wt(l,{get open(){return e(o)},set open(g){t(o,g,!0)},get operator(){return i()},set operator(g){i(g)}})};N(f,l=>{i()&&l(h)})}r(A,y),ue()}function tr(A,a){ce(a,!0);let i=dt(a,["$$slots","$$events","$$legacy"]);const u=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];mt(A,it({name:"refresh-cw"},()=>i,{get iconNode(){return u},children:(o,m)=>{var v=T(),P=s(v);gt(P,()=>a.children??Je),r(o,v)},$$slots:{default:!0}})),ue()}function rr(A,a){ce(a,!0);let i=dt(a,["$$slots","$$events","$$legacy"]);const u=[["path",{d:"M12 13v8"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"}],["path",{d:"m8 17 4-4 4 4"}]];mt(A,it({name:"cloud-upload"},()=>i,{get iconNode(){return u},children:(o,m)=>{var v=T(),P=s(v);gt(P,()=>a.children??Je),r(o,v)},$$slots:{default:!0}})),ue()}var ar=w("<!> Operators",1),or=w("<!> <!> <!>",1),sr=w('<h1 class="text-3xl font-bold"> </h1>'),nr=w('<div class="space-y-4"></div>'),lr=w("<!> Connected",1),ir=w('<div class="mb-8 flex items-center justify-between"><div class="flex items-center gap-2"><h2 class="text-xl font-semibold sm:text-2xl">NATS Server</h2> <!></div></div> <p class="text-muted-foreground mb-5">Connected with the server config below.</p> <!>',1),dr=w("<!> Disconnected",1),cr=w("<!> Download Config",1),ur=w("<!> Generate Proxy Token",1),vr=w("<!> Test Connection",1),fr=w(`<div class="bg-muted/30 dark:bg-muted/50 -mx-2 -mt-2 mb-6 flex items-center justify-center gap-3 rounded-lg p-4"><!> <span class="text-foreground text-sm">NATS server not connected</span></div> <div class="mb-4 flex items-center justify-between"><h2 class="text-xl font-semibold sm:text-2xl">Connect a new NATS server</h2></div> <div class="space-y-8"><div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">1</div> <div class="bg-border mt-2 h-full w-px"></div></div> <div class="flex-1 pb-8"><h3 class="mb-2 font-semibold">Server config</h3> <p class="text-muted-foreground mb-4">Download the NATS server config for your Operator.</p> <!> <p class="text-muted-foreground mb-2">Preview:</p> <!></div></div> <div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">2</div> <div class="bg-border mt-2 h-full w-px"></div></div> <div class="flex-1 pb-8"><h3 class="mb-2 font-semibold">Start the server</h3> <p class="text-muted-foreground mb-4">Start your Operator NATS server using the saved config.</p> <!></div></div> <div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">3</div> <div class="bg-border mt-2 h-full w-px"></div></div> <div class="flex-1 pb-8"><h3 class="mb-2 font-semibold">Proxy Agent token</h3> <p class="text-muted-foreground mb-4">Generate a new Proxy Agent authorization token. Please note that it cannot be
											retrieved again later and must be regenerated if lost.</p> <!></div></div> <div class="flex gap-4"><div class="flex flex-col items-center"><div class="bg-muted flex size-8 items-center justify-center rounded-full font-medium">4</div></div> <div class="flex-1"><h3 class="mb-2 font-semibold">Run the Proxy Agent</h3> <p class="text-muted-foreground mb-4">The Coro Proxy Agent is a lightweight service that connects your Operator NATS
											server to Coro. You can run the service as a Docker container using the latest
											Coro Proxy Agent image.</p> <!> <!></div></div></div>`,1),mr=w('<!> <div class="mb-6"><!></div> <!>',1),gr=w("<main><!></main> <!>",1);function Dr(A,a){ce(a,!0);const i=C(()=>lt.params.namespace??""),u=C(()=>lt.params.operator??"");let o=p(!0),m=p(!0),v=p(!1),P=p(!1),d=p(!1),y=p(!1),_=p(!1),f=p(void 0),h=p(ke([])),l=p(!1),g=p(""),M=p(""),H=p(`docker run --rm corosh/coro-proxy-agent  \\
	--token <PROXY_TOKEN> \\
	--nats-url nats://<NATS_HOST_PORT> \\
	--broker-url ws://<BROKER_HOST_PORT>/api/v1/broker`);const S=new Ee,xe=C(()=>S.paginateAccounts(e(u)));Ct(async()=>{t(o,!0);try{t(f,await S.fetchOperator(e(u)),!0),await re(),t(m,!0),t(g,await S.fetchNATSConfigContent(e(u)),!0)}catch(c){de(c),t(y,!0)}finally{t(o,!1),t(m,!1)}});async function re(){t(d,!0);try{const c=await e(xe).fetchNext();t(h,[...e(h),...c],!0),t(l,e(xe).hasNext(),!0)}catch(c){de(c)}finally{t(d,!1)}}async function ye(){try{t(v,!0);const c=await S.createOperatorProxyToken(e(u));t(M,c.token,!0),t(H,e(H).replace("<PROXY_TOKEN>",e(M)),!0)}catch(c){de(c)}finally{t(v,!1)}}async function $e(){if(e(f))try{t(P,!0),e(f).status=await S.getOperatorProxyStatus(e(u)),e(f).status.connected?At("NATS server connected"):de(St("NATS server not connected"))}catch(c){de(c)}finally{t(P,!1)}}var we=gr(),Y=s(we),ae=$(Y);{var oe=c=>{Yt(c)},Pe=c=>{var ve=mr(),Qe=s(ve);F(Qe,()=>Et,(q,se)=>{se(q,{class:"mb-8",children:(ne,De)=>{var Te=T(),Ie=s(Te);F(Ie,()=>Nt,(ze,V)=>{V(ze,{children:(fe,Re)=>{var le=or(),me=s(le);F(me,()=>ot,(k,z)=>{z(k,{children:(X,_e)=>{var W=T(),b=s(W);{let R=C(()=>`/namespaces/${e(i)}/operators`);F(b,()=>kt,(ie,ge)=>{ge(ie,{get href(){return e(R)},class:"flex items-center gap-2",children:(Ce,j)=>{var K=ar(),B=s(K);Ot(B,{class:"size-4"}),L(),r(Ce,K)},$$slots:{default:!0}})})}r(X,W)},$$slots:{default:!0}})});var E=n(me,2);F(E,()=>It,(k,z)=>{z(k,{})});var I=n(E,2);F(I,()=>ot,(k,z)=>{z(k,{children:(X,_e)=>{var W=T(),b=s(W);F(b,()=>zt,(R,ie)=>{ie(R,{children:(ge,Ce)=>{var j=T(),K=s(j);{var B=D=>{He(D,{class:"h-4 w-24"})},pe=D=>{var Z=Oe();Xe(()=>Ue(Z,e(f)?.name)),r(D,Z)};N(K,D=>{e(o)?D(B):D(pe,!1)})}r(ge,j)},$$slots:{default:!0}})}),r(X,W)},$$slots:{default:!0}})}),r(fe,le)},$$slots:{default:!0}})}),r(ne,Te)},$$slots:{default:!0}})});var Be=n(Qe,2),pt=$(Be);{var _t=q=>{He(q,{class:"h-9 w-48"})},ht=q=>{var se=sr(),ne=$(se,!0);x(se),Xe(()=>Ue(ne,e(f)?.name)),r(q,se)};N(pt,q=>{e(o)?q(_t):q(ht,!1)})}x(Be);var bt=n(Be,2);Rt(bt,{tabNames:["Overview","NATS","Accounts"],children:(se,ne=Je)=>{var De=T(),Te=s(De);{var Ie=V=>{qe(V,{children:(fe,Re)=>{var le=T(),me=s(le);{var E=I=>{er(I,{get loading(){return e(o)},set loading(k){t(o,k,!0)},get operator(){return e(f)},set operator(k){t(f,k,!0)}})};N(me,I=>{e(f)&&I(E)})}r(fe,le)}})},ze=V=>{var fe=T(),Re=s(fe);{var le=E=>{qe(E,{children:(I,k)=>{var z=T(),X=s(z);{var _e=b=>{var R=nr();ct(R,20,()=>({length:5}),Mt,(ie,ge)=>{He(ie,{class:"h-4 w-full"})}),x(R),r(b,R)},W=b=>{var R=T(),ie=s(R);{var ge=j=>{var K=ir(),B=s(K),pe=$(B),D=n($(pe),2);at(D,{variant:"success",class:"mt-0.5 flex items-center gap-1",children:(Me,je)=>{var Ae=lr(),he=s(Ae);st(he,{class:"size-1.5! fill-current"}),L(),r(Me,Ae)},$$slots:{default:!0}}),x(pe),x(B);var Z=n(B,4);be(Z,{get loading(){return e(m)},get content(){return e(g)},wrap:!0}),r(j,K)},Ce=j=>{var K=fr(),B=s(K),pe=$(B);at(pe,{variant:"destructive",class:"flex w-fit items-center gap-1",children:(O,Se)=>{var U=dr(),ee=s(U);st(ee,{class:"size-1.5! fill-current"}),L(),r(O,U)},$$slots:{default:!0}}),L(2),x(B);var D=n(B,4),Z=$(D),Me=n($(Z),2),je=n($(Me),4);Ge(je,{variant:"outline",onclick:()=>Ht(e(g),"nats.conf"),class:"mb-4",children:(O,Se)=>{var U=cr(),ee=s(U);qt(ee,{class:"size-4"}),L(),r(O,U)},$$slots:{default:!0}});var Ae=n(je,4);be(Ae,{get loading(){return e(m)},get content(){return e(g)},wrap:!0}),x(Me),x(Z);var he=n(Z,2),Ve=n($(he),2),xt=n($(Ve),4);be(xt,{loading:!1,content:"nats-server -c nats.conf"}),x(Ve),x(he);var Ke=n(he,2),We=n($(Ke),2),yt=n($(We),4);{var $t=O=>{be(O,{loading:!1,get content(){return e(M)}})},wt=O=>{Ge(O,{onclick:ye,class:"min-w-52",get disabled(){return e(v)},children:(Se,U)=>{var ee=T(),Le=s(ee);{var Fe=J=>{rt(J,{class:"size-4 animate-spin"})},te=J=>{var Ne=ur(),Tt=s(Ne);tr(Tt,{class:"size-4"}),L(),r(J,Ne)};N(Le,J=>{e(v)?J(Fe):J(te,!1)})}r(Se,ee)},$$slots:{default:!0}})};N(yt,O=>{e(M)?O($t):O(wt,!1)})}x(We),x(Ke);var Ze=n(Ke,2),et=n($(Ze),2),tt=n($(et),4);be(tt,{loading:!1,get content(){return e(H)}});var Pt=n(tt,2);Ge(Pt,{class:"mt-5 min-w-44",onclick:$e,get disabled(){return e(P)},children:(O,Se)=>{var U=T(),ee=s(U);{var Le=te=>{rt(te,{class:"size-4 animate-spin"})},Fe=te=>{var J=vr(),Ne=s(J);rr(Ne,{class:"size-4"}),L(),r(te,J)};N(ee,te=>{e(P)?te(Le):te(Fe,!1)})}r(O,U)},$$slots:{default:!0}}),x(et),x(Ze),x(D),r(j,K)};N(ie,j=>{e(f)?.status.connected?j(ge):j(Ce,!1)},!0)}r(b,R)};N(X,b=>{e(o)?b(_e):b(W,!1)})}r(I,z)}})},me=E=>{var I=T(),k=s(I);{var z=X=>{qe(X,{children:(_e,W)=>{Ut(_e,{get accounts(){return e(h)},onloadmore:re,get loading(){return e(o)},set loading(b){t(o,b,!0)},get openCreateModal(){return e(_)},set openCreateModal(b){t(_,b,!0)},get hasMore(){return e(l)},set hasMore(b){t(l,b,!0)},get loadingMore(){return e(d)},set loadingMore(b){t(d,b,!0)}})}})};N(k,X=>{ne()===3&&X(z)},!0)}r(E,I)};N(Re,E=>{ne()===2?E(le):E(me,!1)},!0)}r(V,fe)};N(Te,V=>{ne()===1?V(Ie):V(ze,!1)})}r(se,De)},$$slots:{default:!0}}),r(c,ve)};N(ae,c=>{e(y)?c(oe):c(Pe,!1)})}x(Y);var Q=n(Y,2);{let c=C(()=>e(f)?.id??"");Qt(Q,{get operatorId(){return e(c)},get accounts(){return e(h)},set accounts(ve){t(h,ve,!0)},get open(){return e(_)},set open(ve){t(_,ve,!0)}})}r(A,we),ue()}export{Dr as component};
